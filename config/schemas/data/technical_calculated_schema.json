{
  "name": "Technical Calculated Results Schema",
  "version": "1.0.0",
  "description": "Schema for calculated technical indicators and signals",
  "definitions": {
    "common_technical_fields": {
      "symbol": {
        "type": "string",
        "description": "Stock symbol",
        "pattern": "^[A-Z0-9]{2,10}$"
      },
      "date": {
        "type": "string",
        "format": "date",
        "description": "Trading date"
      },
      "close": {
        "type": "number",
        "minimum": 0,
        "description": "Closing price in VND"
      },
      "volume": {
        "type": "integer",
        "minimum": 0,
        "description": "Trading volume"
      },
      "calculation_date": {
        "type": "string",
        "format": "date-time",
        "description": "Date when calculation was performed"
      },
      "indicator_version": {
        "type": "string",
        "description": "Version of indicator calculation"
      },
      "parameters": {
        "type": "object",
        "description": "Parameters used for calculation"
      }
    },
    "moving_averages": {
      "sma_5": {
        "type": "number",
        "description": "Simple Moving Average 5 periods",
        "minimum": 0
      },
      "sma_10": {
        "type": "number",
        "description": "Simple Moving Average 10 periods",
        "minimum": 0
      },
      "sma_20": {
        "type": "number",
        "description": "Simple Moving Average 20 periods",
        "minimum": 0
      },
      "sma_50": {
        "type": "number",
        "description": "Simple Moving Average 50 periods",
        "minimum": 0
      },
      "sma_100": {
        "type": "number",
        "description": "Simple Moving Average 100 periods",
        "minimum": 0
      },
      "sma_200": {
        "type": "number",
        "description": "Simple Moving Average 200 periods",
        "minimum": 0
      },
      "ema_12": {
        "type": "number",
        "description": "Exponential Moving Average 12 periods",
        "minimum": 0
      },
      "ema_26": {
        "type": "number",
        "description": "Exponential Moving Average 26 periods",
        "minimum": 0
      },
      "ema_50": {
        "type": "number",
        "description": "Exponential Moving Average 50 periods",
        "minimum": 0
      }
    },
    "oscillators": {
      "rsi_14": {
        "type": "number",
        "description": "Relative Strength Index 14 periods",
        "minimum": 0,
        "maximum": 100
      },
      "rsi_21": {
        "type": "number",
        "description": "Relative Strength Index 21 periods",
        "minimum": 0,
        "maximum": 100
      },
      "stoch_k": {
        "type": "number",
        "description": "Stochastic %K",
        "minimum": 0,
        "maximum": 100
      },
      "stoch_d": {
        "type": "number",
        "description": "Stochastic %D",
        "minimum": 0,
        "maximum": 100
      },
      "williams_r": {
        "type": "number",
        "description": "Williams %R",
        "minimum": -100,
        "maximum": 0
      }
    },
    "momentum": {
      "macd": {
        "type": "number",
        "description": "MACD line"
      },
      "macd_signal": {
        "type": "number",
        "description": "MACD signal line"
      },
      "macd_histogram": {
        "type": "number",
        "description": "MACD histogram"
      },
      "roc": {
        "type": "number",
        "description": "Rate of Change"
      },
      "momentum": {
        "type": "number",
        "description": "Momentum indicator"
      }
    },
    "volatility": {
      "atr_14": {
        "type": "number",
        "minimum": 0,
        "description": "Average True Range 14 periods"
      },
      "atr_21": {
        "type": "number",
        "minimum": 0,
        "description": "Average True Range 21 periods"
      },
      "bb_upper": {
        "type": "number",
        "description": "Bollinger Bands Upper",
        "minimum": 0
      },
      "bb_middle": {
        "type": "number",
        "description": "Bollinger Bands Middle",
        "minimum": 0
      },
      "bb_lower": {
        "type": "number",
        "description": "Bollinger Bands Lower",
        "minimum": 0
      },
      "bb_width": {
        "type": "number",
        "minimum": 0,
        "description": "Bollinger Bands Width"
      },
      "bb_position": {
        "type": "number",
        "description": "Bollinger Bands Position (0-1)"
      }
    },
    "volume_indicators": {
      "obv": {
        "type": "number",
        "description": "On Balance Volume"
      },
      "ad_line": {
        "type": "number",
        "description": "Accumulation/Distribution Line"
      },
      "cmf": {
        "type": "number",
        "description": "Chaikin Money Flow",
        "minimum": -1,
        "maximum": 1
      },
      "mfi": {
        "type": "number",
        "minimum": 0,
        "maximum": 100,
        "description": "Money Flow Index"
      },
      "vwap": {
        "type": "number",
        "description": "Volume Weighted Average Price",
        "minimum": 0
      }
    },
    "signals": {
      "ma_cross": {
        "type": "string",
        "enum": ["bullish", "bearish", "neutral"],
        "description": "Moving Average Crossover Signal"
      },
      "rsi_signal": {
        "type": "string",
        "enum": ["overbought", "oversold", "neutral"],
        "description": "RSI Signal"
      },
      "macd_signal": {
        "type": "string",
        "enum": ["bullish", "bearish", "neutral"],
        "description": "MACD Signal"
      },
      "bb_signal": {
        "type": "string",
        "enum": ["squeeze", "expansion", "neutral"],
        "description": "Bollinger Bands Signal"
      },
      "overall_signal": {
        "type": "string",
        "enum": ["strong_buy", "buy", "hold", "sell", "strong_sell"],
        "description": "Overall Technical Signal"
      },
      "signal_strength": {
        "type": "number",
        "minimum": 0,
        "maximum": 100,
        "description": "Signal strength percentage"
      }
    }
  },
  "schemas": {
    "technical_indicators": {
      "type": "object",
      "allOf": [
        {"$ref": "#/definitions/common_technical_fields"},
        {
          "properties": {
            "moving_averages": {"$ref": "#/definitions/moving_averages"},
            "oscillators": {"$ref": "#/definitions/oscillators"},
            "momentum": {"$ref": "#/definitions/momentum"},
            "volatility": {"$ref": "#/definitions/volatility"},
            "volume_indicators": {"$ref": "#/definitions/volume_indicators"}
          }
        }
      ],
      "required": ["symbol", "date", "close", "volume", "calculation_date"]
    },
    "trading_signals": {
      "type": "object",
      "allOf": [
        {"$ref": "#/definitions/common_technical_fields"},
        {
          "properties": {
            "signals": {"$ref": "#/definitions/signals"}
          }
        }
      ],
      "required": ["symbol", "date", "overall_signal", "calculation_date"]
    }
  },
  "validation_rules": {
    "indicator_calculation": {
      "description": "Technical indicators should be calculated correctly",
      "rules": [
        "RSI values should be between 0 and 100",
        "Moving averages should be calculated with correct periods",
        "MACD should be calculated as EMA(12) - EMA(26)",
        "Bollinger Bands should be calculated with correct standard deviations"
      ]
    },
    "signal_consistency": {
      "description": "Signals should be consistent with underlying indicators",
      "rules": [
        "Buy signals should align with bullish indicator readings",
        "Sell signals should align with bearish indicator readings",
        "Signal strength should correlate with indicator magnitude"
      ]
    },
    "temporal_consistency": {
      "description": "Temporal consistency checks",
      "rules": [
        "Indicators should be calculated for the same date",
        "Historical data should be sufficient for calculation",
        "Missing data should be handled appropriately"
      ]
    }
  }
}

