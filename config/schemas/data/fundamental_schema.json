{
  "name": "Fundamental Financial Data Schema",
  "version": "1.0.0",
  "description": "Schema for fundamental financial data (bank and company)",
  "definitions": {
    "common_fields": {
      "symbol": {
        "type": "string",
        "description": "Stock symbol",
        "pattern": "^[A-Z0-9]{2,10}$"
      },
      "report_date": {
        "type": "string",
        "format": "date",
        "description": "Financial report date"
      },
      "year": {
        "type": "integer",
        "minimum": 2000,
        "maximum": 2030,
        "description": "Report year"
      },
      "quarter": {
        "type": "integer",
        "minimum": 1,
        "maximum": 4,
        "description": "Report quarter"
      },
      "freq_code": {
        "type": "string",
        "enum": ["Q", "A", "TTM"],
        "description": "Frequency code"
      }
    },
    "bank_metrics": {
      "npl_amount": {
        "type": "number",
        "minimum": 0,
        "description": "Non-performing loan amount in VND"
      },
      "nii": {
        "type": "number",
        "description": "Net interest income in VND"
      },
      "toi": {
        "type": "number",
        "minimum": 0,
        "description": "Total operating income in VND"
      },
      "noii": {
        "type": "number",
        "description": "Net other operating income in VND"
      },
      "opex": {
        "type": "number",
        "minimum": 0,
        "description": "Operating expenses in VND"
      },
      "ppop": {
        "type": "number",
        "description": "Pre-provision operating profit in VND"
      },
      "provision_expense": {
        "type": "number",
        "minimum": 0,
        "description": "Provision expense in VND"
      },
      "pbt": {
        "type": "number",
        "description": "Profit before tax in VND"
      },
      "npatmi": {
        "type": "number",
        "description": "Net profit after tax and minority interest in VND"
      },
      "interest_income": {
        "type": "number",
        "minimum": 0,
        "description": "Interest income in VND"
      },
      "interest_expense": {
        "type": "number",
        "minimum": 0,
        "description": "Interest expense in VND"
      },
      "iea": {
        "type": "number",
        "minimum": 0,
        "description": "Interest-earning assets in VND"
      },
      "ibl": {
        "type": "number",
        "minimum": 0,
        "description": "Interest-bearing liabilities in VND"
      },
      "total_credit": {
        "type": "number",
        "minimum": 0,
        "description": "Total credit in VND"
      },
      "customer_loan": {
        "type": "number",
        "minimum": 0,
        "description": "Customer loans in VND"
      },
      "customer_deposit": {
        "type": "number",
        "minimum": 0,
        "description": "Customer deposits in VND"
      },
      "roea_ttm": {
        "type": "number",
        "description": "Return on equity TTM (%)"
      },
      "roaa_ttm": {
        "type": "number",
        "description": "Return on average assets TTM (%)"
      },
      "nim_q": {
        "type": "number",
        "description": "Net interest margin quarterly (%)"
      },
      "casa_ratio": {
        "type": "number",
        "minimum": 0,
        "maximum": 100,
        "description": "CASA ratio (%)"
      },
      "cir": {
        "type": "number",
        "minimum": 0,
        "description": "Cost to income ratio (%)"
      },
      "npl_ratio": {
        "type": "number",
        "minimum": 0,
        "maximum": 100,
        "description": "Non-performing loan ratio (%)"
      },
      "ldr_pure": {
        "type": "number",
        "minimum": 0,
        "description": "Loan to deposit ratio pure (%)"
      },
      "bvps": {
        "type": "number",
        "minimum": 0,
        "description": "Book value per share in VND"
      },
      "eps_ttm": {
        "type": "number",
        "description": "Earnings per share TTM in VND"
      }
    },
    "company_metrics": {
      "net_revenue": {
        "type": "number",
        "minimum": 0,
        "description": "Net revenue in VND"
      },
      "cogs": {
        "type": "number",
        "minimum": 0,
        "description": "Cost of goods sold in VND"
      },
      "gross_profit": {
        "type": "number",
        "description": "Gross profit in VND"
      },
      "sga": {
        "type": "number",
        "minimum": 0,
        "description": "Selling, general & administrative expenses in VND"
      },
      "ebit": {
        "type": "number",
        "description": "Earnings before interest and tax in VND"
      },
      "net_finance_income": {
        "type": "number",
        "description": "Net finance income in VND"
      },
      "ebt": {
        "type": "number",
        "description": "Earnings before tax in VND"
      },
      "npatmi": {
        "type": "number",
        "description": "Net profit after tax and minority interest in VND"
      },
      "depreciation": {
        "type": "number",
        "minimum": 0,
        "description": "Depreciation in VND"
      },
      "ebitda": {
        "type": "number",
        "description": "Earnings before interest, tax, depreciation and amortization in VND"
      },
      "gross_margin": {
        "type": "number",
        "description": "Gross margin (%)"
      },
      "ebit_margin": {
        "type": "number",
        "description": "EBIT margin (%)"
      },
      "ebitda_margin": {
        "type": "number",
        "description": "EBITDA margin (%)"
      },
      "net_margin": {
        "type": "number",
        "description": "Net margin (%)"
      },
      "roe": {
        "type": "number",
        "description": "Return on equity (%)"
      },
      "roa": {
        "type": "number",
        "description": "Return on assets (%)"
      },
      "eps": {
        "type": "number",
        "description": "Earnings per share in VND"
      }
    }
  },
  "schemas": {
    "bank": {
      "type": "object",
      "allOf": [
        {"$ref": "#/definitions/common_fields"},
        {"properties": {"$ref": "#/definitions/bank_metrics"}}
      ],
      "required": ["symbol", "report_date", "year", "quarter", "freq_code"]
    },
    "company": {
      "type": "object",
      "allOf": [
        {"$ref": "#/definitions/common_fields"},
        {"properties": {"$ref": "#/definitions/company_metrics"}}
      ],
      "required": ["symbol", "report_date", "year", "quarter", "freq_code"]
    }
  },
  "validation_rules": {
    "financial_relationships": {
      "bank": {
        "nii_toi_ratio": "NII should be part of TOI",
        "pbt_npatmi": "PBT should be >= NPATMI"
      },
      "company": {
        "gross_profit_calculation": "Gross profit = Net revenue - COGS",
        "ebitda_calculation": "EBITDA = EBIT + Depreciation"
      }
    },
    "unit_conversion": {
      "amount_columns": [
        "npl_amount", "nii", "toi", "noii", "opex", "ppop", "provision_expense",
        "pbt", "npatmi", "interest_income", "interest_expense", "iea", "ibl",
        "total_credit", "customer_loan", "customer_deposit", "net_revenue",
        "cogs", "gross_profit", "sga", "ebit", "net_finance_income", "ebt",
        "depreciation", "ebitda"
      ],
      "ratio_columns": [
        "roea_ttm", "roaa_ttm", "nim_q", "casa_ratio", "cir", "npl_ratio",
        "ldr_pure", "gross_margin", "ebit_margin", "ebitda_margin", "net_margin",
        "roe", "roa"
      ],
      "per_share_columns": ["bvps", "eps", "eps_ttm"]
    }
  }
}
